<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="canonical" href="https://noeppi-noeppi.github.io/Crocus/advanced/architecture.html"><link rel=prev href=../getting-started/secrets.html><link rel=next href=configuration-format.html><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.1"><title>Crocus Architecture - Crocus Documentation</title><link rel=stylesheet href=../assets/stylesheets/main.484c7ddc.min.css><link rel=stylesheet href=../assets/stylesheets/palette.ab4e12ef.min.css><link rel="stylesheet" href="../assets/external/fonts.googleapis.com/css.49ea35f2.css"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#crocus-architecture class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../index.html title="Crocus Documentation" class="md-header__button md-logo" aria-label="Crocus Documentation" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Crocus Documentation </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Crocus Architecture </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media=(prefers-color-scheme) data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to system preference" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to system preference" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href="https://github.com/noeppi-noeppi/Crocus" title="Go to repository" class="md-source" data-md-component="source"> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> noeppi-noeppi/Crocus </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../index.html title="Crocus Documentation" class="md-nav__button md-logo" aria-label="Crocus Documentation" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> Crocus Documentation </label> <div class=md-nav__source> <a href="https://github.com/noeppi-noeppi/Crocus" title="Go to repository" class="md-source" data-md-component="source"> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> noeppi-noeppi/Crocus </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../index.html class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Getting Started </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../getting-started/install.html class=md-nav__link> <span class=md-ellipsis> Installing Crocus </span> </a> </li> <li class=md-nav__item> <a href=../getting-started/configuration.html class=md-nav__link> <span class=md-ellipsis> Configuring Crocus </span> </a> </li> <li class=md-nav__item> <a href=../getting-started/run.html class=md-nav__link> <span class=md-ellipsis> Running Crocus </span> </a> </li> <li class=md-nav__item> <a href=../getting-started/secrets.html class=md-nav__link> <span class=md-ellipsis> Providing Secrets </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Advanced Topics </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Advanced Topics </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Crocus Architecture </span> <span class="md-nav__icon md-icon"></span> </label> <a href=architecture.html class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Crocus Architecture </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#events class=md-nav__link> <span class=md-ellipsis> Events </span> </a> <nav class=md-nav aria-label=Events> <ul class=md-nav__list> <li class=md-nav__item> <a href=#attributes class=md-nav__link> <span class=md-ellipsis> Attributes </span> </a> </li> <li class=md-nav__item> <a href=#filters class=md-nav__link> <span class=md-ellipsis> Filters </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#service-interface class=md-nav__link> <span class=md-ellipsis> Service Interface </span> </a> <nav class=md-nav aria-label="Service Interface"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#event-source class=md-nav__link> <span class=md-ellipsis> Event Source </span> </a> </li> <li class=md-nav__item> <a href=#event-filters class=md-nav__link> <span class=md-ellipsis> Event Filters </span> </a> </li> <li class=md-nav__item> <a href=#calendars class=md-nav__link> <span class=md-ellipsis> Calendars </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=configuration-format.html class=md-nav__link> <span class=md-ellipsis> Configuration Reference </span> </a> </li> <li class=md-nav__item> <a href=io-mode.html class=md-nav__link> <span class=md-ellipsis> IO Mode </span> </a> </li> <li class=md-nav__item> <a href=sesquiannual.html class=md-nav__link> <span class=md-ellipsis> Sesquiannual (iCal library) </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Plugins </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Plugins </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../plugins/core.html class=md-nav__link> <span class=md-ellipsis> Core </span> </a> </li> <li class=md-nav__item> <a href=../plugins/anniversary.html class=md-nav__link> <span class=md-ellipsis> Anniversary </span> </a> </li> <li class=md-nav__item> <a href=../plugins/filter.html class=md-nav__link> <span class=md-ellipsis> Filter </span> </a> </li> <li class=md-nav__item> <a href=../plugins/frab.html class=md-nav__link> <span class=md-ellipsis> Frab </span> </a> </li> <li class=md-nav__item> <a href=../plugins/google.html class=md-nav__link> <span class=md-ellipsis> Google </span> </a> </li> <li class=md-nav__item> <a href=../plugins/ical.html class=md-nav__link> <span class=md-ellipsis> iCalendar </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Plugin Development </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Plugin Development </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../development/plugin-loading.html class=md-nav__link> <span class=md-ellipsis> Plugin Loading </span> </a> </li> <li class=md-nav__item> <a href=../development/configuration.html class=md-nav__link> <span class=md-ellipsis> Service Configuration </span> </a> </li> <li class=md-nav__item> <a href=../development/bundling.html class=md-nav__link> <span class=md-ellipsis> Plugin Bundling </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#events class=md-nav__link> <span class=md-ellipsis> Events </span> </a> <nav class=md-nav aria-label=Events> <ul class=md-nav__list> <li class=md-nav__item> <a href=#attributes class=md-nav__link> <span class=md-ellipsis> Attributes </span> </a> </li> <li class=md-nav__item> <a href=#filters class=md-nav__link> <span class=md-ellipsis> Filters </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#service-interface class=md-nav__link> <span class=md-ellipsis> Service Interface </span> </a> <nav class=md-nav aria-label="Service Interface"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#event-source class=md-nav__link> <span class=md-ellipsis> Event Source </span> </a> </li> <li class=md-nav__item> <a href=#event-filters class=md-nav__link> <span class=md-ellipsis> Event Filters </span> </a> </li> <li class=md-nav__item> <a href=#calendars class=md-nav__link> <span class=md-ellipsis> Calendars </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=crocus-architecture>Crocus Architecture</h1> <p>Crocus uses a plugin-based architecture. There is the <em>Crocus Core</em>, which provides an interface for <em>Plugins</em>. A plugin can provide one or multiple <em>Services</em> which extends Crocus' functionality.</p> <p>There are four different kinds of services that plugins can provide:</p> <ul> <li><em>Calendar Types</em> provide a certain type of calendar (event sink). Calendars are responsible for synchronizing events to some kind of external sink. An example for a calendar type is <em>Google Calendar</em> provided by the <a href=../plugins/google.html>Google Plugin</a>.</li> <li><em>Event Source Types</em> provide a certain type of event source. Event sources are responsible for fetching events from some kind of external source. An example for an event source type is <em>iCalendar</em> provided by the <a href=../plugins/ical.html>iCalendar Plugin</a>.</li> <li><em>Event Filter Types</em> provide a certain type of event filter. Event filters are responsible for filtering and modifying events after they have been retrieved from an event source. An example for an event filter type are <em>Simple Filters</em> provided by the <a href=../plugins/filter.html>Filter Plugin</a>.</li> <li><em>Attribute Providers</em> are used to register additional <a href=#attributes>attributes</a> to store additional data on events.</li> </ul> <h2 id=events>Events</h2> <p>The central type object that Crocus deals with is the event. Crocus models an event in a rather simple way, using only these attributes:</p> <ul> <li>An identifier that must be unique among all events from the same event source.</li> <li>A name of the event</li> <li>An optional description of the event</li> <li>An optional location of the event</li> <li>An optional absolute URL describing the event</li> <li>Date and Time information</li> </ul> <p>Most event sources provide additional information about events, and most calendars accept additional information about events. Crocus intentionally keeps the number of event fields to a minimum, but allows plugins to register additional <a href=#attributes>attributes</a> that can attach extra information to events.</p> <p>Unlike many other calendar-related applications, Crocus events do not support recurrence. Recurring events are probably the feature that causes the most complexity and incompatibility issues in calendar-related software.</p> <p>Therefore, Crocus does not support recurrence at all. Event sources that fetch events from a source supporting recurrence must expand these into individual event instances and pass them to Crocus separately. Calendars that push events to a sink supporting recurrence may detect the expanded recurrence and collapse them back into a single event. Consequently, Crocus cannot fully support events repeating infinitely and must cut repetition off at some point in time.</p> <p>The date and time of an event is always one of the following types:</p> <ul> <li>A start date and an end date, each consisting of a year, month and day. Both the start and end days are part of the event.</li> <li>A start timestamp and an end timestamp, both with nanosecond precision.</li> <li>A start timestamp with nanosecond precision but no end timestamp. In this case, the event is treated as open-ended with an unknown duration.</li> </ul> <p>Note that an event does not store time zone information in any of these cases. Time zones are a property of calendars, not events. Therefore, calendar implementations are required to convert timestamps into the appropriate local time for their event sink.</p> <h3 id=attributes>Attributes</h3> <p>Attributes allow plugins to attach extra information to events. Plugins can register attributes by providing an <em>attribute provider</em> service.</p> <p>An attribute consists of a unique name and an optional default value, as well as a function that encodes how to serialise and deserialise its values. The Crocus core itself provides no additional attributes. However, some of the bundled plugins do. See the <a href=../plugins/core.html>plugin section</a> for details.</p> <h3 id=filters>Filters</h3> <p>Event filters are added to event sources. As well as discarding events, an event filter can modify them as they pass through the filter. Multiple filters added to an event source are invoked in the order they were added.</p> <p>Event filters cannot modify the unique identifiers of events passing through them and therefore cannot turn a single event into multiple events.</p> <h2 id=service-interface>Service Interface</h2> <p>This section documents, what logic event sources, filters and calendars need to provide and what logic is performed by the Crocus core.</p> <h3 id=event-source>Event Source</h3> <p>Event sources only have a single function, which is fetching the underlying source and returning a list of events for further processing by crocus. Crocus always expects an event source to return all events from the underlying source. However, if the underlying source support incremental requests, where it only sends changes that were made since the last run, the event source service may store the retrieved events in the <code>plugin-data</code> folder and then use incremental fetch to fetch changes and build a complete event list from these.</p> <p>The only function of event sources is to fetch the underlying source and return a list of events for further processing by Crocus. Crocus always expects an event source to return all events from the underlying source. However, if the underlying source supports incremental requests and only sends changes made since the last run, the event source service can make of that and store the retrieved events in the <code>plugin-data</code> folder. On the next run, it can then use incremental fetch to retrieve the changes and compile a full list of events.</p> <h3 id=event-filters>Event Filters</h3> <p>Event filters also only have a single function. They retrieve one event after another. For each event, they may return it unchanged, return a changed event return no event at all, in which case the event is dropped. Filters should not keep internal state as it is not specified, in which order they will receive the events retrieved from an event source.</p> <h3 id=calendars>Calendars</h3> <p>As Crocus pushes incremental updates to calendars by default, the API that calendars need to provide is more complex than that of event sources and filters. Calendar implementations need to provide the following functionality:</p> <ul> <li><em>Synchronise changed events</em>: The calendar receives two lists: one of events that are either new or modified, and one of deleted events. It then needs to apply these changes to the downstream event sink.</li> <li><em>Delete some events only if they exist</em>: In the event of an error or crash, Crocus stores a list of event identifiers that could exist in the calendar but are not in a known state. The next time Crocus runs, the calendar needs to delete all these events to return the calendar to a known state.</li> <li><em>Delete all events in the calendar</em>: This is mainly required to support the <code>--no-incremental</code> option. In this case, Crocus has no knowledge of the calendar's state and resets it completely before pushing any events.</li> </ul> <p>Downstream calendars often use their own identifiers for events that are randomly generated by the calendar itself. Crocus handles the mapping from internal Crocus event identifiers to identifiers native to the downstream calendar. Therefore, calendar implementations must notify Crocus immediately once a new native event identifier has been assigned to an event.</p> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener"> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"annotate": null, "base": "..", "features": ["content.code.copy", "content.code.annotate"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../assets/javascripts/bundle.79ae519e.min.js></script> </body> </html>